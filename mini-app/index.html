<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>–ö–∞–º–ø—É—Å - –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- MAX Bridge SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MAX Bridge (–∏—Å–ø–æ–ª—å–∑—É–µ–º WebApp API –∫–∞–∫ –≤ Telegram Mini Apps)
        // MAX –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API —Å Telegram Web Apps
        window.MAXBridge = {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp
            init: function() {
                if (window.Telegram && window.Telegram.WebApp) {
                    window.Telegram.WebApp.ready();
                    window.Telegram.WebApp.expand();
                    return window.Telegram.WebApp;
                }
                // Fallback –¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ WebApp –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω
                return {
                    initData: this.getInitData(),
                    initDataUnsafe: this.getInitDataUnsafe(),
                    version: '1.0',
                    platform: 'web',
                    colorScheme: 'light',
                    themeParams: {
                        bg_color: '#ffffff',
                        text_color: '#000000',
                        hint_color: '#999999',
                        link_color: '#2481cc',
                        button_color: '#2481cc',
                        button_text_color: '#ffffff'
                    },
                    isExpanded: true,
                    viewportHeight: window.innerHeight,
                    viewportStableHeight: window.innerHeight,
                    headerColor: '#ffffff',
                    backgroundColor: '#ffffff',
                    BackButton: {
                        isVisible: false,
                        onClick: function(callback) {},
                        show: function() {},
                        hide: function() {}
                    },
                    MainButton: {
                        text: '',
                        color: '#2481cc',
                        textColor: '#ffffff',
                        isVisible: false,
                        isActive: true,
                        isProgressVisible: false,
                        setText: function(text) {},
                        onClick: function(callback) {},
                        show: function() {},
                        hide: function() {},
                        enable: function() {},
                        disable: function() {},
                        showProgress: function() {},
                        hideProgress: function() {}
                    },
                    ready: function() {},
                    expand: function() {},
                    close: function() {},
                    sendData: function(data) {
                        console.log('Send data to bot:', data);
                    },
                    openLink: function(url) {
                        window.open(url, '_blank');
                    },
                    openTelegramLink: function(url) {
                        window.open(url, '_blank');
                    },
                    showPopup: function(params) {
                        if (confirm(params.message)) {
                            params.callback && params.callback();
                        }
                    },
                    showAlert: function(message) {
                        alert(message);
                    },
                    showConfirm: function(message, callback) {
                        if (confirm(message)) {
                            callback && callback(true);
                        } else {
                            callback && callback(false);
                        }
                    },
                    showScanQrPopup: function(params) {
                        alert('QR —Å–∫–∞–Ω–µ—Ä –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –≤–µ–±-–≤–µ—Ä—Å–∏–∏');
                    },
                    closeScanQrPopup: function() {},
                    readTextFromClipboard: function(callback) {
                        navigator.clipboard.readText().then(callback).catch(() => callback(''));
                    },
                    requestWriteAccess: function(callback) {
                        callback && callback(true);
                    },
                    requestContact: function(callback) {
                        alert('–ó–∞–ø—Ä–æ—Å –∫–æ–Ω—Ç–∞–∫—Ç–∞ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
                    }
                };
            },
            // –ü–æ–ª—É—á–µ–Ω–∏–µ initData –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            getInitData: function() {
                const urlParams = new URLSearchParams(window.location.search);
                const startapp = urlParams.get('startapp');
                if (startapp) {
                    return startapp;
                }
                // –§–æ—Ä–º–∏—Ä—É–µ–º initData –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL
                const params = [];
                urlParams.forEach((value, key) => {
                    params.push(`${key}=${encodeURIComponent(value)}`);
                });
                return params.join('&');
            },
            // –ü–æ–ª—É—á–µ–Ω–∏–µ initDataUnsafe (—Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
            getInitDataUnsafe: function() {
                const urlParams = new URLSearchParams(window.location.search);
                const startapp = urlParams.get('startapp');
                
                let data = {};
                if (startapp) {
                    try {
                        const decoded = decodeURIComponent(startapp);
                        const params = new URLSearchParams(decoded);
                        params.forEach((value, key) => {
                            data[key] = value;
                        });
                    } catch (e) {
                        console.error('–û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è startapp:', e);
                    }
                } else {
                    // –ü–æ–ª—É—á–∞–µ–º –∏–∑ –æ–±—ã—á–Ω—ã—Ö URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                    urlParams.forEach((value, key) => {
                        data[key] = value;
                    });
                }
                
                return {
                    query_id: data.query_id || '',
                    user: data.user_id ? {
                        id: parseInt(data.user_id),
                        first_name: data.user_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                        last_name: '',
                        username: '',
                        language_code: 'ru'
                    } : null,
                    auth_date: Date.now(),
                    hash: '',
                    start_param: data.start_param || null
                };
            },
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            getUser: function() {
                const initData = this.getInitDataUnsafe();
                return initData.user;
            },
            // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
            getStartParam: function() {
                const initData = this.getInitDataUnsafe();
                return initData.start_param;
            }
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º WebApp –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        let WebApp;
        document.addEventListener('DOMContentLoaded', function() {
            WebApp = window.MAXBridge.init();
            console.log('MAX Bridge initialized:', WebApp);
            console.log('User data:', window.MAXBridge.getUser());
            console.log('Start param:', window.MAXBridge.getStartParam());
        });
    </script>
</head>
<body>
    <div id="app">
        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </div>

        <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
        <div id="main-screen" class="screen hidden">
            <header class="header">
                <h1>üè´ –ö–∞–º–ø—É—Å</h1>
                <button id="settings-btn" class="icon-btn">‚öôÔ∏è</button>
            </header>

            <div class="user-info" id="user-info">
                <p id="group-info">–ì—Ä—É–ø–ø–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞</p>
            </div>

            <div class="tiles">
                <div class="tile" data-section="schedule">
                    <div class="tile-icon">üìÖ</div>
                    <div class="tile-title">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</div>
                </div>
                <div class="tile" data-section="teachers">
                    <div class="tile-icon">üë®‚Äçüè´</div>
                    <div class="tile-title">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏</div>
                </div>
                <div class="tile" data-section="events">
                    <div class="tile-icon">üéâ</div>
                    <div class="tile-title">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</div>
                </div>
                <div class="tile" data-section="deadlines">
                    <div class="tile-icon">‚è∞</div>
                    <div class="tile-title">–î–µ–¥–ª–∞–π–Ω—ã</div>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è -->
        <div id="schedule-screen" class="screen hidden">
            <header class="header">
                <button class="back-btn" data-back="main">‚Üê –ù–∞–∑–∞–¥</button>
                <h2>üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h2>
            </header>

            <div class="schedule-controls">
                <button class="period-btn active" data-period="today">–°–µ–≥–æ–¥–Ω—è</button>
                <button class="period-btn" data-period="tomorrow">–ó–∞–≤—Ç—Ä–∞</button>
                <button class="period-btn" data-period="week">–ù–µ–¥–µ–ª—è</button>
            </div>

            <div id="schedule-content" class="content">
                <!-- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ —Å—é–¥–∞ -->
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π -->
        <div id="teachers-screen" class="screen hidden">
            <header class="header">
                <button class="back-btn" data-back="main">‚Üê –ù–∞–∑–∞–¥</button>
                <h2>üë®‚Äçüè´ –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏</h2>
            </header>

            <div class="search-box">
                <input type="text" id="teacher-search" placeholder="–ü–æ–∏—Å–∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è...">
            </div>

            <div id="teachers-content" class="content">
                <!-- –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π -->
        <div id="events-screen" class="screen hidden">
            <header class="header">
                <button class="back-btn" data-back="main">‚Üê –ù–∞–∑–∞–¥</button>
                <h2>üéâ –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h2>
            </header>

            <div id="events-content" class="content">
                <!-- –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –¥–µ–¥–ª–∞–π–Ω–æ–≤ -->
        <div id="deadlines-screen" class="screen hidden">
            <header class="header">
                <button class="back-btn" data-back="main">‚Üê –ù–∞–∑–∞–¥</button>
                <h2>‚è∞ –î–µ–¥–ª–∞–π–Ω—ã</h2>
            </header>

            <div class="add-deadline-btn-container">
                <button id="add-deadline-btn" class="add-btn">+ –î–æ–±–∞–≤–∏—Ç—å –¥–µ–¥–ª–∞–π–Ω</button>
            </div>

            <div id="deadlines-content" class="content">
                <!-- –î–µ–¥–ª–∞–π–Ω—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
        <div id="settings-screen" class="screen hidden">
            <header class="header">
                <button class="back-btn" data-back="main">‚Üê –ù–∞–∑–∞–¥</button>
                <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            </header>

            <div class="settings-content">
                <div class="setting-item">
                    <label>–ì—Ä—É–ø–ø–∞</label>
                    <div id="group-selector" class="selector">
                        <span id="current-group">–ù–µ –≤—ã–±—Ä–∞–Ω–∞</span>
                        <button id="select-group-btn">–í—ã–±—Ä–∞—Ç—å</button>
                    </div>
                </div>

                <div class="setting-item">
                    <label>–ü–æ–¥–≥—Ä—É–ø–ø–∞</label>
                    <div id="subgroup-selector" class="selector">
                        <span id="current-subgroup">–ù–µ –≤—ã–±—Ä–∞–Ω–∞</span>
                        <button id="select-subgroup-btn">–í—ã–±—Ä–∞—Ç—å</button>
                    </div>
                </div>

                <div class="setting-item">
                    <label>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¥–µ–¥–ª–∞–π–Ω–∞—Ö</label>
                    <label class="switch">
                        <input type="checkbox" id="notifications-toggle">
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="setting-item">
                    <label>–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</label>
                    <label class="switch">
                        <input type="checkbox" id="events-subscribe-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–µ–¥–ª–∞–π–Ω–∞ -->
        <div id="add-deadline-modal" class="modal hidden">
            <div class="modal-content">
                <h3>–î–æ–±–∞–≤–∏—Ç—å –¥–µ–¥–ª–∞–π–Ω</h3>
                <input type="text" id="deadline-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                <textarea id="deadline-description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
                <input type="date" id="deadline-date">
                <div class="modal-buttons">
                    <button id="save-deadline-btn" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button id="cancel-deadline-btn" class="btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –≥—Ä—É–ø–ø—ã -->
        <div id="group-modal" class="modal hidden">
            <div class="modal-content">
                <h3>–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</h3>
                <div id="group-selection-content">
                    <!-- –ì—Ä—É–ø–ø—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
                </div>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>
</html>
